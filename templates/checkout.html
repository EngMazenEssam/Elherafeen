<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout | Elherafeen Store</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/Home.css') }}">
  <!-- Checkout styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/checkout.css') }}">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

<header>
  <div class="container">
    <div class="top-row">
      <div class="logo">
        <img src="{{ url_for('static', filename='images/icons/ELHERAFEEN LOGO BLACK.png') }}" alt="ELHERAFEEN">
      </div>

      <div class="search-bar">
        <input type="search" placeholder="Search for parts">
      </div>

      <div class="icons">
        <a href="{{ url_for('cart.cart') }}">Cart</a>
        <a class="btn auth" href="{{ url_for('customer.login') }}">Login</a>
      </div>
    </div>

    <nav class="sections">
      <a href="{{ url_for('home.home') }}">Home</a>
      <a href="#">Section 2</a>
      <a href="#">Section 3</a>
      <a href="#">Section 4</a>
      <a href="#">Section 5</a>
    </nav>
  </div>
</header>

<main>
  <section class="checkout-section">
    <div class="container cart-layout">

      <div class="cart-header-text">
        <h1>Checkout</h1>
        <p>Please enter your billing and shipping information.</p>
      </div>

      <div class="checkout-content">

        <aside class="checkout-summary">
          <h2>Order Summary</h2>

          <div class="summary-item">
            <span>Items ({{ cart.total_items }})</span>
            <span>{{ cart.subtotal }} EGP</span>
          </div>

          <div class="summary-item">
            <span>Estimated Shipping</span>
            <span>{{ cart.shipping }} EGP</span>
          </div>

          <div class="summary-item">
            <span>Tax</span>
            <span>{{ cart.tax }} EGP</span>
          </div>

          <hr>

          <div class="summary-item">
            <strong>Total</strong>
            <strong>{{ cart.total_price }} EGP</strong>
          </div>

          <hr>

          <ul class="checkout-products">
            {% for item in cart_items %}
              <li>
                <strong>{{ item.name }}</strong> x {{ item.quantity }}
                - {{ item.line_total }} EGP
              </li>
            {% endfor %}
          </ul>
        </aside>

        <form class="checkout-form" method="POST" action="{{ url_for('checkout.process_checkout') }}">

          {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="alerts">
              {% for category, msg in messages %}
                <li class="{{ category }}">{{ msg }}</li>
              {% endfor %}
            </ul>
          {% endif %}
          {% endwith %}

          <div class="form-group">
            <label>First Name</label>
            <input type="text" name="first_name" class="form-input" required>
          </div>

          <div class="form-group">
            <label>Last Name</label>
            <input type="text" name="last_name" class="form-input" required>
          </div>

          <div class="form-group full-width">
            <label>Email Address</label>
            <input type="email" name="email" class="form-input" required>
          </div>

          <div class="form-group">
            <label>Phone</label>
            <input type="text" name="phone" class="form-input" required>
          </div>

          <div class="form-group full-width">
            <label>Shipping Address</label>
            <input type="text" name="address" class="form-input" required>
          </div>

          <div class="form-group">
            <label>City</label>
            <input type="text" name="city" class="form-input" required>
          </div>

          <div class="form-group">
            <label>ZIP Code</label>
            <input type="text" name="zip" class="form-input" required>
          </div>

          <div class="form-group full-width">
            <label>Payment Method</label>
            <select name="payment" id="payment-method" class="form-input">
              <option value="cod">Cash on Delivery</option>
              <option value="credit">Credit / Debit Card</option>
            </select>
          </div>

          <div id="card-fields" class="card-fields">
            <div class="form-group">
              <label>Card Number</label>
              <input type="text"
                    id="card-number"
                    name="card_number"
                    class="form-input"
                    placeholder="1234 5678 9012 3456">
            </div>

            <div class="form-group">
              <label>Expiry Date</label>
              <input type="text"
                    id="card-expiry"
                    name="card_expiry"
                    class="form-input"
                    placeholder="MM/YY">
            </div>

            <div class="form-group">
              <label>CVV</label>
              <input type="text"
                    id="card-cvv"
                    name="card_cvv"
                    class="form-input"
                    placeholder="123">
            </div>
          </div>

          <button type="submit" class="submit-order">
            <i class="fas fa-shopping-bag"></i> Place Order
          </button>

        </form>
      </div>

    </div>
  </section>
</main>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const paymentSelect = document.getElementById("payment-method");
    const cardFields = document.getElementById("card-fields");
    const cardNumber = document.getElementById("card-number");
    const cardExpiry = document.getElementById("card-expiry");
    const cardCvv = document.getElementById("card-cvv");

    function updateCardFields() {
      const isCredit = paymentSelect.value === "credit";
      if (isCredit) {
        cardFields.classList.add("show");
        cardNumber.required = true;
        cardExpiry.required = true;
        cardCvv.required = true;
      } else {
        cardFields.classList.remove("show");
        cardNumber.required = false;
        cardExpiry.required = false;
        cardCvv.required = false;
      }
    }

    paymentSelect.addEventListener("change", updateCardFields);
    updateCardFields();
  });
</script>

</body>
</html>
