<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELHERAFEEN - Auto Parts</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="container header">
            <a href="/" class="logo">ELHERAFEEN</a>
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" placeholder="Search..." class="search-input">
            </div>
            <div class="nav-icons">
                <button class="nav-icon"><i class="far fa-user"></i></button>
                <button class="nav-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="badge" style="display:none">0</span>
                </button>
            </div>
        </div>
    </header>

    <div class="container main-layout">
        <aside>
            <div class="sidebar-box">
                <div class="sidebar-header"><h3 class="sidebar-title">Categories</h3></div>
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-link active" onclick="filterCategory(event, 'All')">All Products</a>
                    {% for cat in categories %}
                    <a href="#" class="sidebar-link" onclick="filterCategory(event, '{{ cat }}')">{{ cat }}</a>
                    {% endfor %}
                </nav>
            </div>
        </aside>

        <main>
            <div class="page-header">
                <h2 class="page-title" id="categoryTitle">All Products</h2>
                <span class="result-count" id="resultCount">Showing {{ products|length }} results</span>
            </div>
            <div id="productGrid" class="grid-container"></div>
        </main>
    </div>

    <script>
        const allProducts = {{ products | tojson }};
        const productGrid = document.getElementById('productGrid');
        const categoryTitle = document.getElementById('categoryTitle');
        const resultCount = document.getElementById('resultCount');

        function getImage(category) {
            const icons = {'Engine': 'fa-cogs', 'Brakes': 'fa-compact-disc', 'Electrical': 'fa-bolt', 'Suspension': 'fa-spring', 'Cooling': 'fa-fan', 'Fluids': 'fa-oil-can'};
            const colors = {'Engine': 'bg-gray-200', 'Brakes': 'bg-red-50', 'Electrical': 'bg-yellow-50', 'Suspension': 'bg-blue-50', 'Cooling': 'bg-cyan-50', 'Fluids': 'bg-amber-50'};
            return `<div class="card-img-wrapper ${colors[category]||'bg-gray-200'}"><i class="fas ${icons[category]||'fa-box'} card-icon"></i></div>`;
        }

        function renderProducts(products) {
            productGrid.innerHTML = '';
            resultCount.textContent = `Showing ${products.length} results`;
            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.onclick = () => window.location.href = `/product/${p.id}`;
                card.innerHTML = `
                    <div style="position:relative">
                        ${getImage(p.category)}
                        <span class="card-badge">${p.condition}</span>
                    </div>
                    <div class="card-body">
                        <span class="brand-text">${p.brand}</span>
                        <h3 class="product-name">${p.name}</h3>
                        <div class="card-footer">
                            <div><span class="price">${p.price} <span class="currency">${p.currency}</span></span></div>
                            <button class="btn-icon"><i class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>`;
                productGrid.appendChild(card);
            });
        }

        function filterCategory(e, cat) {
            e.preventDefault();
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            e.target.classList.add('active');
            categoryTitle.textContent = cat === 'All' ? 'All Products' : cat;
            renderProducts(cat === 'All' ? allProducts : allProducts.filter(p => p.category === cat));
        }

        renderProducts(allProducts);
        
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            renderProducts(allProducts.filter(p => p.name.toLowerCase().includes(term) || p.oem.toLowerCase().includes(term)));
        });
    </script>
</body>
</html>